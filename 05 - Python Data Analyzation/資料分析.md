# 資料IO
```python
# 資料的匯入
import pandas as pd

df = pd.read_csv('data/employees.csv')
print(type(df))
print(df.tail())
print(df.salary.mean())
# 資料的匯出
df = df.tail()
df.to_csv('data/new.csv')
```

    <class 'pandas.core.frame.DataFrame'>
         employee_id first_name last_name     email  phone_number      job_id  \
    102          202        Pat       Fay      PFAY  603.123.6666      MK_REP   
    103          203      Susan    Mavris   SMAVRIS  515.123.7777      HR_REP   
    104          204    Hermann      Baer     HBAER  515.123.8888      PR_REP   
    105          205    Shelley   Higgins  SHIGGINS  515.123.8080      AC_MGR   
    106          206    William     Gietz    WGIETZ  515.123.8181  AC_ACCOUNT   
    
          salary  commission_pct  manager_id  department_id  
    102   6000.0             NaN       201.0           20.0  
    103   6500.0             NaN       101.0           40.0  
    104  10000.0             NaN       101.0           70.0  
    105  12000.0             NaN       101.0          110.0  
    106   8300.0             NaN       205.0          110.0  
    6461.682242990654
## JSON
```python
# json
df = pd.read_json('data/data1.json')
print(type(df))

import json

with open('data/test.json') as f:
    data = json.load(f)
# print(data['users'])
print(type(data))
df = pd.DataFrame(data['users'])
print(type(df))
df
```

    <class 'pandas.core.frame.DataFrame'>
    <class 'dict'>
    <class 'pandas.core.frame.DataFrame'>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>age</th>
      <th>email</th>
      <th>is_active</th>
      <th>join_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>張三</td>
      <td>28</td>
      <td>zhangsan@example.com</td>
      <td>True</td>
      <td>2022-03-15</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>李四</td>
      <td>35</td>
      <td>lisi@example.com</td>
      <td>False</td>
      <td>2021-11-02</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>王五</td>
      <td>24</td>
      <td>wangwu@example.com</td>
      <td>True</td>
      <td>2023-01-20</td>
    </tr>
  </tbody>
</table>
</div>

# 缺失值的處理
```python

# nan:not a number
import pandas as pd
import numpy as np

s = pd.Series([12, 25, np.nan, None, pd.NA])
df = pd.DataFrame([1, pd.NA, 2](1,%20pd.NA,%202), columns=['第1列', '第2列', '第3列'])
print(s)
# 檢視是否是缺失值
print(s.isna())
print(s.isnull())
print(df.isna())
print(df.isnull())
print(df.isna().sum(axis=1))
print(s.isna().sum())  #檢視缺失值的個數

# 剔除缺失值
print(s.dropna())
print('-' * 30)
print(df)
print(df.dropna())  #剔除一整條的記錄
print(df.dropna(how='all'))  #如果所有的值都是缺失值，刪除這一行
print(df.dropna(thresh=1))  #如果至少有n個值不是缺失值，就保留
print(df.dropna(axis=1))  #剔除一整列的記錄
print(df.dropna(subset=['第1列']))  #如果某列有缺失值，則刪除這一行

# 填充缺失值
df = pd.read_csv('data/weather_withna.csv')
df.tail()
df.isna().sum(axis=0)
df.head()
print(df.fillna({'temp_max': 20, 'wind': 2.5}).tail())  #使用字典來填充
print(df.fillna(df['temp_max', 'wind']('temp_max',%20'wind').mean()).tail())  #使用統計值來填充
print(df.ffill().tail())  #用前面的相鄰值填充
print(df.bfill().tail())  #用後面的相鄰值填充
```

    0      12
    1      25
    2     NaN
    3    None
    4    <NA>
    dtype: object
    0    False
    1    False
    2     True
    3     True
    4     True
    dtype: bool
    0    False
    1    False
    2     True
    3     True
    4     True
    dtype: bool
         第1列    第2列    第3列
    0  False   True  False
    1  False  False  False
    2   True  False  False
         第1列    第2列    第3列
    0  False   True  False
    1  False  False  False
    2   True  False  False
    0    1
    1    0
    2    1
    dtype: int64
    3
    0    12
    1    25
    dtype: object
    ------------------------------
       第1列   第2列  第3列
    0  1.0  <NA>    2
    1  2.0     3    5
    2  NaN     4    6
       第1列 第2列  第3列
    1  2.0   3    5
       第1列   第2列  第3列
    0  1.0  <NA>    2
    1  2.0     3    5
    2  NaN     4    6
       第1列   第2列  第3列
    0  1.0  <NA>    2
    1  2.0     3    5
    2  NaN     4    6
       第3列
    0    2
    1    5
    2    6
       第1列   第2列  第3列
    0  1.0  <NA>    2
    1  2.0     3    5
                date  precipitation  temp_max  temp_min  wind weather
    1456  2015-12-27            NaN      20.0       NaN   2.5     NaN
    1457  2015-12-28            NaN      20.0       NaN   2.5     NaN
    1458  2015-12-29            NaN      20.0       NaN   2.5     NaN
    1459  2015-12-30            NaN      20.0       NaN   2.5     NaN
    1460  2015-12-31           20.6      12.2       5.0   3.8    rain
                date  precipitation   temp_max  temp_min      wind weather
    1456  2015-12-27            NaN  15.851468       NaN  3.242055     NaN
    1457  2015-12-28            NaN  15.851468       NaN  3.242055     NaN
    1458  2015-12-29            NaN  15.851468       NaN  3.242055     NaN
    1459  2015-12-30            NaN  15.851468       NaN  3.242055     NaN
    1460  2015-12-31           20.6  12.200000       5.0  3.800000    rain
                date  precipitation  temp_max  temp_min  wind weather
    1456  2015-12-27            0.0      11.1       4.4   4.8     sun
    1457  2015-12-28            0.0      11.1       4.4   4.8     sun
    1458  2015-12-29            0.0      11.1       4.4   4.8     sun
    1459  2015-12-30            0.0      11.1       4.4   4.8     sun
    1460  2015-12-31           20.6      12.2       5.0   3.8    rain
                date  precipitation  temp_max  temp_min  wind weather
    1456  2015-12-27           20.6      12.2       5.0   3.8    rain
    1457  2015-12-28           20.6      12.2       5.0   3.8    rain
    1458  2015-12-29           20.6      12.2       5.0   3.8    rain
    1459  2015-12-30           20.6      12.2       5.0   3.8    rain
    1460  2015-12-31           20.6      12.2       5.0   3.8    rain

---
# 時間資料的處理
```python

import pandas as pd

d = pd.Timestamp('2015-02-28 10:22')
d1 = pd.Timestamp('2015-02-28 13:22')
print(d)
print(type(d))
print("年：", d.year)
print("月：", d.month)
print("日：", d.day)
print(d.hour, d.minute, d.second)
print("季度：", d.quarter)
print("是否是月底：", d.is_month_end)
# 方法
print("星期幾：", d.day_name())
print("轉換為天：", d.to_period("D"))
print("轉換為季度：", d1.to_period("Q"))
print("轉換為年度：", d1.to_period("Y"))
print("轉換為月度：", d1.to_period("M"))
print("轉換為周維度：", d1.to_period("W"))
```

    2015-02-28 10:22:00
    <class 'pandas._libs.tslibs.timestamps.Timestamp'>
    年： 2015
    月： 2
    日： 28
    10 22 0
    季度： 1
    是否是月底： True
    星期幾： Saturday
    轉換為天： 2015-02-28
    轉換為季度： 2015Q1
    轉換為年度： 2015
    轉換為月度： 2015-02
    轉換為周維度： 2015-02-23/2015-03-01


```python
# 字串轉換為日期型別
a = pd.to_datetime('20150228')
print(a)
print(type(a))
print(a.day_name())

# dataFrame 日期轉換
df = pd.DataFrame({
    'sales': [100, 200, 300],
    'date': ['20250601', '20250602', '20250603']
})
df['datetime'] = pd.to_datetime(df['date'])
df
print(df.info())
print(type(df['datetime']))
df['week'] = df['datetime'].dt.day_name()
df['datetime'].dt.year


```

    2015-02-28 00:00:00
    <class 'pandas._libs.tslibs.timestamps.Timestamp'>
    Saturday
    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 3 entries, 0 to 2
    Data columns (total 3 columns):
     #   Column    Non-Null Count  Dtype         
    ---  ------    --------------  -----         
     0   sales     3 non-null      int64         
     1   date      3 non-null      object        
     2   datetime  3 non-null      datetime64[ns]
    dtypes: datetime64[ns](1), int64(1), object(1)
    memory usage: 204.0+ bytes
    None
    <class 'pandas.core.series.Series'>

    0    2025
    1    2025
    2    2025
    Name: datetime, dtype: int32

```python
# csv 日期轉換
df = pd.read_csv('data/weather.csv', parse_dates=['date'])
df.info()
df['date'].dt.day_name()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 1461 entries, 0 to 1460
    Data columns (total 6 columns):
     #   Column         Non-Null Count  Dtype         
    ---  ------         --------------  -----         
     0   date           1461 non-null   datetime64[ns]
     1   precipitation  1461 non-null   float64       
     2   temp_max       1461 non-null   float64       
     3   temp_min       1461 non-null   float64       
     4   wind           1461 non-null   float64       
     5   weather        1461 non-null   object        
    dtypes: datetime64[ns](1), float64(4), object(1)
    memory usage: 68.6+ KB

    0          Sunday
    1          Monday
    2         Tuesday
    3       Wednesday
    4        Thursday
              ...    
    1456       Sunday
    1457       Monday
    1458      Tuesday
    1459    Wednesday
    1460     Thursday
    Name: date, Length: 1461, dtype: object




```python
# 日期資料作為索引
# df.set_index('date' , inplace=True)#設定原來的df的索引
print(df.loc["2013-01":"2013-02"])
```

    Empty DataFrame
    Columns: [date, precipitation, temp_max, temp_min, wind, weather]
    Index: []


```python
# 時間間隔
d1 = pd.Timestamp('2013-01-15')
d2 = pd.Timestamp('2023-02-23')
d3 = d2 - d1
print(type(d3))
print(d3)
```

    <class 'pandas._libs.tslibs.timedeltas.Timedelta'>
    3691 days 00:00:00

```python
df = pd.read_csv('data/weather.csv', parse_dates=['date'])
df.info()
df['delta'] = df['date'] - df['date'][0]
df.set_index('delta', inplace=True)
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 1461 entries, 0 to 1460
    Data columns (total 6 columns):
     #   Column         Non-Null Count  Dtype         
    ---  ------         --------------  -----         
     0   date           1461 non-null   datetime64[ns]
     1   precipitation  1461 non-null   float64       
     2   temp_max       1461 non-null   float64       
     3   temp_min       1461 non-null   float64       
     4   wind           1461 non-null   float64       
     5   weather        1461 non-null   object        
    dtypes: datetime64[ns](1), float64(4), object(1)
    memory usage: 68.6+ KB



```python
df
print(df.loc['10 days':'20 days'])
```

                  date  precipitation  temp_max  temp_min  wind weather
    delta                                                              
    10 days 2012-01-11            0.0       6.1      -1.1   5.1     sun
    11 days 2012-01-12            0.0       6.1      -1.7   1.9     sun
    12 days 2012-01-13            0.0       5.0      -2.8   1.3     sun
    13 days 2012-01-14            4.1       4.4       0.6   5.3    snow
    14 days 2012-01-15            5.3       1.1      -3.3   3.2    snow
    15 days 2012-01-16            2.5       1.7      -2.8   5.0    snow
    16 days 2012-01-17            8.1       3.3       0.0   5.6    snow
    17 days 2012-01-18           19.8       0.0      -2.8   5.0    snow
    18 days 2012-01-19           15.2      -1.1      -2.8   1.6    snow
    19 days 2012-01-20           13.5       7.2      -1.1   2.3    snow
    20 days 2012-01-21            3.0       8.3       3.3   8.2    rain



```python
days = pd.date_range("2025-07-03", "2026-02-09", freq="W")
days = pd.date_range("2025-07-03", periods=10, freq="QE")
print(days)
```

    DatetimeIndex(['2025-09-30', '2025-12-31', '2026-03-31', '2026-06-30',
                   '2026-09-30', '2026-12-31', '2027-03-31', '2027-06-30',
                   '2027-09-30', '2027-12-31'],
                  dtype='datetime64[ns]', freq='QE-DEC')

```python
df = pd.read_csv('data/weather.csv', parse_dates=['date'])
# 重新取樣
df.set_index('date', inplace=True)
```


```python
df["temp_max", "temp_min"]("temp_max",%20"temp_min").resample("MS").mean()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>temp_max</th>
      <th>temp_min</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-01-01</th>
      <td>7.054839</td>
      <td>1.541935</td>
    </tr>
    <tr>
      <th>2012-02-01</th>
      <td>9.275862</td>
      <td>3.203448</td>
    </tr>
    <tr>
      <th>2012-03-01</th>
      <td>9.554839</td>
      <td>2.838710</td>
    </tr>
    <tr>
      <th>2012-04-01</th>
      <td>14.873333</td>
      <td>5.993333</td>
    </tr>
    <tr>
      <th>2012-05-01</th>
      <td>17.661290</td>
      <td>8.190323</td>
    </tr>
    <tr>
      <th>2012-06-01</th>
      <td>18.693333</td>
      <td>10.480000</td>
    </tr>
    <tr>
      <th>2012-07-01</th>
      <td>22.906452</td>
      <td>12.932258</td>
    </tr>
    <tr>
      <th>2012-08-01</th>
      <td>25.858065</td>
      <td>14.009677</td>
    </tr>
    <tr>
      <th>2012-09-01</th>
      <td>22.880000</td>
      <td>11.243333</td>
    </tr>
    <tr>
      <th>2012-10-01</th>
      <td>15.829032</td>
      <td>8.380645</td>
    </tr>
    <tr>
      <th>2012-11-01</th>
      <td>11.326667</td>
      <td>5.226667</td>
    </tr>
    <tr>
      <th>2012-12-01</th>
      <td>7.235484</td>
      <td>3.293548</td>
    </tr>
    <tr>
      <th>2013-01-01</th>
      <td>6.106452</td>
      <td>0.796774</td>
    </tr>
    <tr>
      <th>2013-02-01</th>
      <td>9.467857</td>
      <td>4.325000</td>
    </tr>
    <tr>
      <th>2013-03-01</th>
      <td>12.709677</td>
      <td>4.977419</td>
    </tr>
    <tr>
      <th>2013-04-01</th>
      <td>14.243333</td>
      <td>6.696667</td>
    </tr>
    <tr>
      <th>2013-05-01</th>
      <td>19.625806</td>
      <td>9.922581</td>
    </tr>
    <tr>
      <th>2013-06-01</th>
      <td>23.253333</td>
      <td>13.163333</td>
    </tr>
    <tr>
      <th>2013-07-01</th>
      <td>26.093548</td>
      <td>13.932258</td>
    </tr>
    <tr>
      <th>2013-08-01</th>
      <td>26.119355</td>
      <td>15.480645</td>
    </tr>
    <tr>
      <th>2013-09-01</th>
      <td>21.360000</td>
      <td>13.590000</td>
    </tr>
    <tr>
      <th>2013-10-01</th>
      <td>14.229032</td>
      <td>7.638710</td>
    </tr>
    <tr>
      <th>2013-11-01</th>
      <td>12.053333</td>
      <td>5.590000</td>
    </tr>
    <tr>
      <th>2013-12-01</th>
      <td>7.022581</td>
      <td>1.570968</td>
    </tr>
    <tr>
      <th>2014-01-01</th>
      <td>9.600000</td>
      <td>4.096774</td>
    </tr>
    <tr>
      <th>2014-02-01</th>
      <td>8.200000</td>
      <td>2.635714</td>
    </tr>
    <tr>
      <th>2014-03-01</th>
      <td>12.906452</td>
      <td>5.425806</td>
    </tr>
    <tr>
      <th>2014-04-01</th>
      <td>15.460000</td>
      <td>6.730000</td>
    </tr>
    <tr>
      <th>2014-05-01</th>
      <td>19.870968</td>
      <td>10.216129</td>
    </tr>
    <tr>
      <th>2014-06-01</th>
      <td>21.590000</td>
      <td>11.756667</td>
    </tr>
    <tr>
      <th>2014-07-01</th>
      <td>26.900000</td>
      <td>14.425806</td>
    </tr>
    <tr>
      <th>2014-08-01</th>
      <td>26.383871</td>
      <td>14.893548</td>
    </tr>
    <tr>
      <th>2014-09-01</th>
      <td>23.163333</td>
      <td>13.233333</td>
    </tr>
    <tr>
      <th>2014-10-01</th>
      <td>17.961290</td>
      <td>10.883871</td>
    </tr>
    <tr>
      <th>2014-11-01</th>
      <td>11.030000</td>
      <td>4.510000</td>
    </tr>
    <tr>
      <th>2014-12-01</th>
      <td>10.138710</td>
      <td>4.609677</td>
    </tr>
    <tr>
      <th>2015-01-01</th>
      <td>10.154839</td>
      <td>4.351613</td>
    </tr>
    <tr>
      <th>2015-02-01</th>
      <td>12.517857</td>
      <td>6.085714</td>
    </tr>
    <tr>
      <th>2015-03-01</th>
      <td>14.377419</td>
      <td>6.193548</td>
    </tr>
    <tr>
      <th>2015-04-01</th>
      <td>15.503333</td>
      <td>6.030000</td>
    </tr>
    <tr>
      <th>2015-05-01</th>
      <td>20.025806</td>
      <td>10.129032</td>
    </tr>
    <tr>
      <th>2015-06-01</th>
      <td>26.063333</td>
      <td>13.576667</td>
    </tr>
    <tr>
      <th>2015-07-01</th>
      <td>28.093548</td>
      <td>15.500000</td>
    </tr>
    <tr>
      <th>2015-08-01</th>
      <td>26.087097</td>
      <td>14.693548</td>
    </tr>
    <tr>
      <th>2015-09-01</th>
      <td>20.293333</td>
      <td>11.366667</td>
    </tr>
    <tr>
      <th>2015-10-01</th>
      <td>17.538710</td>
      <td>10.500000</td>
    </tr>
    <tr>
      <th>2015-11-01</th>
      <td>9.683333</td>
      <td>3.480000</td>
    </tr>
    <tr>
      <th>2015-12-01</th>
      <td>8.380645</td>
      <td>3.825806</td>
    </tr>
  </tbody>
</table>
</div>




```python
df["temp_max", "temp_min"]("temp_max",%20"temp_min").resample("YE").mean()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>temp_max</th>
      <th>temp_min</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-12-31</th>
      <td>15.276776</td>
      <td>7.289617</td>
    </tr>
    <tr>
      <th>2013-12-31</th>
      <td>16.058904</td>
      <td>8.153973</td>
    </tr>
    <tr>
      <th>2014-12-31</th>
      <td>16.995890</td>
      <td>8.662466</td>
    </tr>
    <tr>
      <th>2015-12-31</th>
      <td>17.427945</td>
      <td>8.835616</td>
    </tr>
  </tbody>
</table>
</div>

```python
import pandas as pd

data = {
    "name": ['alice', 'alice', 'bob', 'alice', 'jack', 'bob'],
    "age": [26, 25, 30, 25, 35, 30],
    'city': ['NY', 'NY', 'LA', 'NY', 'SF', 'LA']
}
df = pd.DataFrame(data)
```


```python
df.duplicated()  #一整條記錄都是一樣的，標記為重複，返回True
df.drop_duplicates(subset=['name'])  #根據指定列去重
df.drop_duplicates(subset=['name'], keep='last')  #保留最後一次出現的行
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>age</th>
      <th>city</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>alice</td>
      <td>25</td>
      <td>NY</td>
    </tr>
    <tr>
      <th>4</th>
      <td>jack</td>
      <td>35</td>
      <td>SF</td>
    </tr>
    <tr>
      <th>5</th>
      <td>bob</td>
      <td>30</td>
      <td>LA</td>
    </tr>
  </tbody>
</table>
</div>

---
# 資料型別的轉換
```python

df = pd.read_csv('data/sleep.csv')
df.dtypes
```

    person_id                    int64
    gender                      object
    age                          int64
    occupation                  object
    sleep_duration             float64
    sleep_quality              float64
    physical_activity_level      int64
    stress_level                 int64
    bmi_category                object
    blood_pressure              object
    heart_rate                   int64
    daily_steps                  int64
    sleep_disorder              object
    dtype: object




```python
df['age'] = df['age'].astype('int16')
```


```python
df['gender'] = df['gender'].astype('category')
```


```python
df.gender
```


    0        Male
    1      Female
    2        Male
    3        Male
    4        Male
            ...  
    395    Female
    396    Female
    397    Female
    398    Female
    399      Male
    Name: gender, Length: 400, dtype: category
    Categories (2, object): ['Female', 'Male']




```python
df['is_male'] = df['gender'].map({'Female': True, 'Male': False})
```


```python
df.is_male
```




    0      False
    1       True
    2      False
    3      False
    4      False
           ...  
    395     True
    396     True
    397     True
    398     True
    399    False
    Name: is_male, Length: 400, dtype: category
    Categories (2, bool): [True, False]

---
# 資料變形
```python

import pandas as pd

data = {
    'ID': [1, 2],
    'name': ['alice', 'bob'],
    'Math': [90, 85],
    'English': [88, 92],
    'Science': [95, 89]
}
df = pd.DataFrame(data)
print(df)
df.T  #行列轉置
# 寬錶轉換成長表
df2 = pd.melt(df, id_vars=['ID', 'name'], var_name='科目', value_name='分數')
df2.sort_values('name')
print(df2)
# 長錶轉寬表
pd.pivot(df2, index=['ID', 'name'], columns='科目', values='分數')
```

       ID   name  Math  English  Science
    0   1  alice    90       88       95
    1   2    bob    85       92       89
       ID   name       科目  分數
    0   1  alice     Math  90
    1   2    bob     Math  85
    2   1  alice  English  88
    3   2    bob  English  92
    4   1  alice  Science  95
    5   2    bob  Science  89





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>科目</th>
      <th>English</th>
      <th>Math</th>
      <th>Science</th>
    </tr>
    <tr>
      <th>ID</th>
      <th>name</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <th>alice</th>
      <td>88</td>
      <td>90</td>
      <td>95</td>
    </tr>
    <tr>
      <th>2</th>
      <th>bob</th>
      <td>92</td>
      <td>85</td>
      <td>89</td>
    </tr>
  </tbody>
</table>
</div>




```python
data = {
    'ID': [1, 2],
    'name': ['alice smith', 'bob smith'],
    'Math': [90, 85],
    'English': [88, 92],
    'Science': [95, 89]
}
df = pd.DataFrame(data)
# 分列
df['first', 'last']('first',%20'last') = df['name'].str.split(" ", expand=True)
df = pd.read_csv('data/sleep.csv')
df = df['person_id', 'blood_pressure']('person_id',%20'blood_pressure')
df['high', 'low']('high',%20'low') = df['blood_pressure'].str.split('/', expand=True)
df['high'] = df['high'].astype('int64')
df['low'] = df['low'].astype('int64')
df.info()
df.high.mean()
df.low.mean()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 400 entries, 0 to 399
    Data columns (total 4 columns):
     #   Column          Non-Null Count  Dtype 
    ---  ------          --------------  ----- 
     0   person_id       400 non-null    int64 
     1   blood_pressure  400 non-null    object
     2   high            400 non-null    int64 
     3   low             400 non-null    int64 
    dtypes: int64(3), object(1)
    memory usage: 12.6+ KB

    np.float64(73.04)

```python
# 資料分箱 pd.cut(x,bins,labels)
import pandas as pd
df = pd.read_csv('data/employees.csv')
df.head(10)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>employee_id</th>
      <th>first_name</th>
      <th>last_name</th>
      <th>email</th>
      <th>phone_number</th>
      <th>job_id</th>
      <th>salary</th>
      <th>commission_pct</th>
      <th>manager_id</th>
      <th>department_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>100</td>
      <td>Steven</td>
      <td>King</td>
      <td>SKING</td>
      <td>515.123.4567</td>
      <td>AD_PRES</td>
      <td>24000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>101</td>
      <td>N_ann</td>
      <td>Kochhar</td>
      <td>NKOCHHAR</td>
      <td>515.123.4568</td>
      <td>AD_VP</td>
      <td>17000.0</td>
      <td>NaN</td>
      <td>100.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>102</td>
      <td>Lex</td>
      <td>De Haan</td>
      <td>LDEHAAN</td>
      <td>515.123.4569</td>
      <td>AD_VP</td>
      <td>17000.0</td>
      <td>NaN</td>
      <td>100.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>103</td>
      <td>Alexander</td>
      <td>Hunold</td>
      <td>AHUNOLD</td>
      <td>590.423.4567</td>
      <td>IT_PROG</td>
      <td>9000.0</td>
      <td>NaN</td>
      <td>102.0</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>104</td>
      <td>Bruce</td>
      <td>Ernst</td>
      <td>BERNST</td>
      <td>590.423.4568</td>
      <td>IT_PROG</td>
      <td>6000.0</td>
      <td>NaN</td>
      <td>103.0</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>105</td>
      <td>David</td>
      <td>Austin</td>
      <td>DAUSTIN</td>
      <td>590.423.4569</td>
      <td>IT_PROG</td>
      <td>4800.0</td>
      <td>NaN</td>
      <td>103.0</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>106</td>
      <td>Valli</td>
      <td>Pataballa</td>
      <td>VPATABAL</td>
      <td>590.423.4560</td>
      <td>IT_PROG</td>
      <td>4800.0</td>
      <td>NaN</td>
      <td>103.0</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>107</td>
      <td>Diana</td>
      <td>Lorentz</td>
      <td>DLORENTZ</td>
      <td>590.423.5567</td>
      <td>IT_PROG</td>
      <td>4200.0</td>
      <td>NaN</td>
      <td>103.0</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>108</td>
      <td>Nancy</td>
      <td>Greenberg</td>
      <td>NGREENBE</td>
      <td>515.124.4569</td>
      <td>FI_MGR</td>
      <td>12000.0</td>
      <td>NaN</td>
      <td>101.0</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>109</td>
      <td>Daniel</td>
      <td>Faviet</td>
      <td>DFAVIET</td>
      <td>515.124.4169</td>
      <td>FI_ACCOUNT</td>
      <td>9000.0</td>
      <td>NaN</td>
      <td>108.0</td>
      <td>100.0</td>
    </tr>
  </tbody>
</table>
</div>

```python
df1 = df.head(10)['employee_id', 'salary']('employee_id',%20'salary')
df1
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>employee_id</th>
      <th>salary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>100</td>
      <td>24000.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>101</td>
      <td>17000.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>102</td>
      <td>17000.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>103</td>
      <td>9000.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>104</td>
      <td>6000.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>105</td>
      <td>4800.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>106</td>
      <td>4800.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>107</td>
      <td>4200.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>108</td>
      <td>12000.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>109</td>
      <td>9000.0</td>
    </tr>
  </tbody>
</table>
</div>

```python
pd.cut(df1['salary'], bins=3)  #bins=n，分成n段區間，起始值、結束值是所有資料的最小值、最大值
#4180~14100~24000
pd.cut(df1['salary'], bins=3).value_counts()
pd.cut(df1['salary'], bins=[0, 10000, 20000, 30000])  #bins=list，分成n段區間
pd.cut(df1['salary'], bins=[0, 10000, 20000, 30000]).value_counts()
df1['收入範圍'] = pd.cut(df1['salary'], bins=[0, 10000, 20000, 30000], labels=['低', '中', '高'])  #bins=list，分成n段區間
pd.qcut(df1['salary'], 3).value_counts()
```




    salary
    (12000.0, 24000.0]    4
    (4199.999, 6000.0]    3
    (6000.0, 12000.0]     3
    Name: count, dtype: int64

```python
# 睡眠資料
df = pd.read_csv('data/sleep.csv')
df1 = df.head(10)['person_id', 'sleep_quality']('person_id',%20'sleep_quality')
df1
df['睡眠質量'] = pd.cut(df['sleep_quality'], bins=3, labels=
['差', '中', '優'])
df['睡眠質量'].value_counts()
df.head(10)
df['gender'] = df['gender'].astype('category')
df['gender'].value_counts()
# 字串-->類別-->統計
# 數值-->分箱-->統計
print(df['gender'].dtype)
print(df['睡眠質量'].dtype)
```

    category
    category
---
```python
# df.rename()   df.set_index()  df.reset_index()
df = pd.DataFrame({
    'name': ['jack', 'alice', 'tom', 'bob'],
    'age': [20, 30, 40, 50],
    'gender': ['female', 'male', 'female', 'male']
})
df.set_index("name", inplace=True)
df.reset_index(inplace=True)
df.rename(columns={"age": "年齡"}, index={0: 4})
```
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>年齡</th>
      <th>gender</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>jack</td>
      <td>20</td>
      <td>female</td>
    </tr>
    <tr>
      <th>1</th>
      <td>alice</td>
      <td>30</td>
      <td>male</td>
    </tr>
    <tr>
      <th>2</th>
      <td>tom</td>
      <td>40</td>
      <td>female</td>
    </tr>
    <tr>
      <th>3</th>
      <td>bob</td>
      <td>50</td>
      <td>male</td>
    </tr>
  </tbody>
</table>
</div>
---
```python
df.index = [1, 2, 3, 4]
df.columns = ["姓名", '年齡', "性別"]
df
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>姓名</th>
      <th>年齡</th>
      <th>性別</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>jack</td>
      <td>20</td>
      <td>female</td>
    </tr>
    <tr>
      <th>2</th>
      <td>alice</td>
      <td>30</td>
      <td>male</td>
    </tr>
    <tr>
      <th>3</th>
      <td>tom</td>
      <td>40</td>
      <td>female</td>
    </tr>
    <tr>
      <th>4</th>
      <td>bob</td>
      <td>50</td>
      <td>male</td>
    </tr>
  </tbody>
</table>
</div>
---
```python
# 分組聚合
# df.groupby('分組的欄位')['聚合的欄位'].聚合函式()
import pandas as pd

df = pd.read_csv('data/employees.csv')
df = df.dropna(subset=['department_id'])
df['department_id'] = df['department_id'].astype('int64')
# 計算不同部門的平均薪資
df.groupby('department_id').groups  #檢視分組
df.groupby('department_id').get_group(20)  #檢視具體的某個分組資料
df2 = df.groupby('department_id')['salary']('salary').mean()
df2['salary'] = df2['salary'].round(2)
df2 = df2.reset_index()
df2.sort_values('salary', ascending=False)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>department_id</th>
      <th>salary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>90</td>
      <td>19333.33</td>
    </tr>
    <tr>
      <th>10</th>
      <td>110</td>
      <td>10150.00</td>
    </tr>
    <tr>
      <th>6</th>
      <td>70</td>
      <td>10000.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20</td>
      <td>9500.00</td>
    </tr>
    <tr>
      <th>7</th>
      <td>80</td>
      <td>8955.88</td>
    </tr>
    <tr>
      <th>9</th>
      <td>100</td>
      <td>8600.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40</td>
      <td>6500.00</td>
    </tr>
    <tr>
      <th>5</th>
      <td>60</td>
      <td>5760.00</td>
    </tr>
    <tr>
      <th>0</th>
      <td>10</td>
      <td>4400.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30</td>
      <td>4150.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>50</td>
      <td>3475.56</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 計算不同部門不同崗位的人的平均薪資
df2 = df.groupby(['department_id', 'job_id'])['salary']('salary').mean()
df2 = df2.reset_index()
df2['salary'] = df2['salary'].round(1)
df2.sort_values('salary', ascending=False)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>department_id</th>
      <th>job_id</th>
      <th>salary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>90</td>
      <td>AD_PRES</td>
      <td>24000.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>90</td>
      <td>AD_VP</td>
      <td>17000.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20</td>
      <td>MK_MAN</td>
      <td>13000.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>80</td>
      <td>SA_MAN</td>
      <td>12200.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>100</td>
      <td>FI_MGR</td>
      <td>12000.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>110</td>
      <td>AC_MGR</td>
      <td>12000.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>30</td>
      <td>PU_MAN</td>
      <td>11000.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>70</td>
      <td>PR_REP</td>
      <td>10000.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>80</td>
      <td>SA_REP</td>
      <td>8396.6</td>
    </tr>
    <tr>
      <th>17</th>
      <td>110</td>
      <td>AC_ACCOUNT</td>
      <td>8300.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>100</td>
      <td>FI_ACCOUNT</td>
      <td>7920.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>50</td>
      <td>ST_MAN</td>
      <td>7280.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>40</td>
      <td>HR_REP</td>
      <td>6500.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>MK_REP</td>
      <td>6000.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>60</td>
      <td>IT_PROG</td>
      <td>5760.0</td>
    </tr>
    <tr>
      <th>0</th>
      <td>10</td>
      <td>AD_ASST</td>
      <td>4400.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>50</td>
      <td>SH_CLERK</td>
      <td>3215.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>50</td>
      <td>ST_CLERK</td>
      <td>2785.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>PU_CLERK</td>
      <td>2780.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 企鵝資料分析
# 1. 匯入必要的庫
import pandas as pd
import numpy as np

# 2. 匯入資料 喙
df = pd.read_csv('data/penguins.csv')
df.head(5)
df.info()

```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 344 entries, 0 to 343
    Data columns (total 7 columns):
     #   Column             Non-Null Count  Dtype  
    ---  ------             --------------  -----  
     0   species            344 non-null    object 
     1   island             344 non-null    object 
     2   bill_length_mm     342 non-null    float64
     3   bill_depth_mm      342 non-null    float64
     4   flipper_length_mm  342 non-null    float64
     5   body_mass_g        342 non-null    float64
     6   sex                333 non-null    object 
    dtypes: float64(4), object(3)
    memory usage: 18.9+ KB



```python
# 3. 資料清洗
# 缺失值的檢查
print(df.isna().sum())
df.dropna(inplace=True)
```

    species               0
    island                0
    bill_length_mm        2
    bill_depth_mm         2
    flipper_length_mm     2
    body_mass_g           2
    sex                  11
    dtype: int64



```python
# 4. 資料特徵的構造
df['sex'] = df['sex'].astype('category')
df['bill_ratio'] = df['bill_length_mm'] / df['bill_depth_mm']
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
      <th>bill_ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.1</td>
      <td>18.7</td>
      <td>181.0</td>
      <td>3750.0</td>
      <td>Male</td>
      <td>2.090909</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.5</td>
      <td>17.4</td>
      <td>186.0</td>
      <td>3800.0</td>
      <td>Female</td>
      <td>2.270115</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>40.3</td>
      <td>18.0</td>
      <td>195.0</td>
      <td>3250.0</td>
      <td>Female</td>
      <td>2.238889</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>36.7</td>
      <td>19.3</td>
      <td>193.0</td>
      <td>3450.0</td>
      <td>Female</td>
      <td>1.901554</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.3</td>
      <td>20.6</td>
      <td>190.0</td>
      <td>3650.0</td>
      <td>Male</td>
      <td>1.907767</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 5. 資料分析
# 資料分箱-把體重分為三個等級
labels = ['低', '中', '高']
df['mass_level'] = pd.cut(df['body_mass_g'], bins=3, labels=labels)
print(df['mass_level'].value_counts())
# 按島嶼、性別分組分析
df.groupby(['sex', 'island']).agg({
    'body_mass_g': ['mean', 'count'],
})
```

    mass_level
    低    150
    中    128
    高     55
    Name: count, dtype: int64


    /tmp/ipykernel_696402/1536504977.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
      df.groupby(['sex', 'island']).agg({





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">body_mass_g</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>mean</th>
      <th>count</th>
    </tr>
    <tr>
      <th>sex</th>
      <th>island</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">Female</th>
      <th>Biscoe</th>
      <td>4319.375000</td>
      <td>80</td>
    </tr>
    <tr>
      <th>Dream</th>
      <td>3446.311475</td>
      <td>61</td>
    </tr>
    <tr>
      <th>Torgersen</th>
      <td>3395.833333</td>
      <td>24</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">Male</th>
      <th>Biscoe</th>
      <td>5104.518072</td>
      <td>83</td>
    </tr>
    <tr>
      <th>Dream</th>
      <td>3987.096774</td>
      <td>62</td>
    </tr>
    <tr>
      <th>Torgersen</th>
      <td>4034.782609</td>
      <td>23</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 睡眠質量分析
# 1.匯入庫
import pandas as pd
import numpy as np

# 2.匯入資料
df = pd.read_csv('data/sleep.csv')
df.head()
df.info()
df.describe()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 400 entries, 0 to 399
    Data columns (total 13 columns):
     #   Column                   Non-Null Count  Dtype  
    ---  ------                   --------------  -----  
     0   person_id                400 non-null    int64  
     1   gender                   400 non-null    object 
     2   age                      400 non-null    int64  
     3   occupation               400 non-null    object 
     4   sleep_duration           400 non-null    float64
     5   sleep_quality            400 non-null    float64
     6   physical_activity_level  400 non-null    int64  
     7   stress_level             400 non-null    int64  
     8   bmi_category             400 non-null    object 
     9   blood_pressure           400 non-null    object 
     10  heart_rate               400 non-null    int64  
     11  daily_steps              400 non-null    int64  
     12  sleep_disorder           110 non-null    object 
    dtypes: float64(2), int64(6), object(5)
    memory usage: 40.8+ KB





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person_id</th>
      <th>age</th>
      <th>sleep_duration</th>
      <th>sleep_quality</th>
      <th>physical_activity_level</th>
      <th>stress_level</th>
      <th>heart_rate</th>
      <th>daily_steps</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>400.000000</td>
      <td>400.000000</td>
      <td>400.000000</td>
      <td>400.000000</td>
      <td>400.000000</td>
      <td>400.00000</td>
      <td>400.000000</td>
      <td>400.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>200.500000</td>
      <td>39.950000</td>
      <td>8.041250</td>
      <td>6.125750</td>
      <td>64.985000</td>
      <td>5.47250</td>
      <td>75.990000</td>
      <td>11076.510000</td>
    </tr>
    <tr>
      <th>std</th>
      <td>115.614301</td>
      <td>14.038883</td>
      <td>2.390787</td>
      <td>1.975733</td>
      <td>32.297874</td>
      <td>2.80873</td>
      <td>15.099334</td>
      <td>5364.789364</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>18.000000</td>
      <td>4.100000</td>
      <td>1.000000</td>
      <td>10.000000</td>
      <td>1.00000</td>
      <td>50.000000</td>
      <td>2067.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>100.750000</td>
      <td>29.000000</td>
      <td>5.900000</td>
      <td>4.700000</td>
      <td>35.000000</td>
      <td>3.00000</td>
      <td>63.000000</td>
      <td>6165.250000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>200.500000</td>
      <td>40.000000</td>
      <td>8.200000</td>
      <td>6.100000</td>
      <td>65.500000</td>
      <td>5.00000</td>
      <td>77.000000</td>
      <td>11785.500000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>300.250000</td>
      <td>49.000000</td>
      <td>10.125000</td>
      <td>7.425000</td>
      <td>94.000000</td>
      <td>8.00000</td>
      <td>90.000000</td>
      <td>15878.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>400.000000</td>
      <td>90.000000</td>
      <td>12.000000</td>
      <td>10.000000</td>
      <td>120.000000</td>
      <td>10.00000</td>
      <td>100.000000</td>
      <td>19958.000000</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 3.資料清洗
df.isna().sum()
df.drop(columns='sleep_disorder', inplace=True)
```


```python
# 4. 資料特徵的構造
df['gender'] = df['gender'].astype('category')
df['occupation'] = df['occupation'].astype('category')
df['bmi_category'] = df['bmi_category'].astype('category')
df['high', 'low']('high',%20'low') = df['blood_pressure'].str.split('/', expand=True)

# 睡眠質量的分箱
labels = ['差', '中', '優']
df['quality_level'] = pd.cut(df['sleep_quality'], bins=3, labels=labels)
age_labels = ['青少年', '中年', '老年']
df['age_level'] = pd.cut(df['age'], bins=3, labels=age_labels)
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person_id</th>
      <th>gender</th>
      <th>age</th>
      <th>occupation</th>
      <th>sleep_duration</th>
      <th>sleep_quality</th>
      <th>physical_activity_level</th>
      <th>stress_level</th>
      <th>bmi_category</th>
      <th>blood_pressure</th>
      <th>heart_rate</th>
      <th>daily_steps</th>
      <th>high</th>
      <th>low</th>
      <th>quality_level</th>
      <th>age_level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Male</td>
      <td>29</td>
      <td>Manual Labor</td>
      <td>7.4</td>
      <td>7.0</td>
      <td>41</td>
      <td>7</td>
      <td>Obese</td>
      <td>124/70</td>
      <td>91</td>
      <td>8539</td>
      <td>124</td>
      <td>70</td>
      <td>中</td>
      <td>青少年</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Female</td>
      <td>43</td>
      <td>Retired</td>
      <td>4.2</td>
      <td>4.9</td>
      <td>41</td>
      <td>5</td>
      <td>Obese</td>
      <td>131/86</td>
      <td>81</td>
      <td>18754</td>
      <td>131</td>
      <td>86</td>
      <td>中</td>
      <td>中年</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Male</td>
      <td>44</td>
      <td>Retired</td>
      <td>6.1</td>
      <td>6.0</td>
      <td>107</td>
      <td>4</td>
      <td>Underweight</td>
      <td>122/70</td>
      <td>81</td>
      <td>2857</td>
      <td>122</td>
      <td>70</td>
      <td>中</td>
      <td>中年</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Male</td>
      <td>29</td>
      <td>Office Worker</td>
      <td>8.3</td>
      <td>10.0</td>
      <td>20</td>
      <td>10</td>
      <td>Obese</td>
      <td>124/72</td>
      <td>55</td>
      <td>6886</td>
      <td>124</td>
      <td>72</td>
      <td>優</td>
      <td>青少年</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Male</td>
      <td>67</td>
      <td>Retired</td>
      <td>9.1</td>
      <td>9.5</td>
      <td>19</td>
      <td>4</td>
      <td>Overweight</td>
      <td>133/78</td>
      <td>97</td>
      <td>14945</td>
      <td>133</td>
      <td>78</td>
      <td>優</td>
      <td>老年</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 5.資料的統計、分析
print(df['bmi_category'].value_counts())
```

    bmi_category
    Overweight     109
    Underweight    102
    Obese           98
    Normal          91
    Name: count, dtype: int64



```python
# 根據不同的bmi分組，睡眠質量
df.groupby(['age_level', 'bmi_category']).agg({
    'sleep_duration': 'mean',
    'sleep_quality': 'mean',
    'stress_level': 'mean'
})
```

    /tmp/ipykernel_696402/3959039482.py:2: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
      df.groupby(['age_level', 'bmi_category']).agg({





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>sleep_duration</th>
      <th>sleep_quality</th>
      <th>stress_level</th>
    </tr>
    <tr>
      <th>age_level</th>
      <th>bmi_category</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="4" valign="top">青少年</th>
      <th>Normal</th>
      <td>8.100000</td>
      <td>6.332000</td>
      <td>4.860000</td>
    </tr>
    <tr>
      <th>Obese</th>
      <td>8.250000</td>
      <td>6.253448</td>
      <td>5.534483</td>
    </tr>
    <tr>
      <th>Overweight</th>
      <td>8.214286</td>
      <td>6.171429</td>
      <td>5.317460</td>
    </tr>
    <tr>
      <th>Underweight</th>
      <td>7.603279</td>
      <td>5.883607</td>
      <td>5.426230</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">中年</th>
      <th>Normal</th>
      <td>7.422222</td>
      <td>6.650000</td>
      <td>4.944444</td>
    </tr>
    <tr>
      <th>Obese</th>
      <td>7.805556</td>
      <td>6.216667</td>
      <td>5.888889</td>
    </tr>
    <tr>
      <th>Overweight</th>
      <td>8.246154</td>
      <td>5.956410</td>
      <td>5.974359</td>
    </tr>
    <tr>
      <th>Underweight</th>
      <td>8.497500</td>
      <td>5.907500</td>
      <td>5.750000</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">老年</th>
      <th>Normal</th>
      <td>7.420000</td>
      <td>4.240000</td>
      <td>4.200000</td>
    </tr>
    <tr>
      <th>Obese</th>
      <td>7.900000</td>
      <td>5.025000</td>
      <td>8.000000</td>
    </tr>
    <tr>
      <th>Overweight</th>
      <td>8.971429</td>
      <td>6.285714</td>
      <td>6.714286</td>
    </tr>
    <tr>
      <th>Underweight</th>
      <td>10.500000</td>
      <td>6.200000</td>
      <td>6.000000</td>
    </tr>
  </tbody>
</table>
</div>


